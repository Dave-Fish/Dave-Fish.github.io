<!DOCTYPE  html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="author" content="Dave Davies">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>Fungal Creep</title>
	<link rel="icon" type="image/png" href="face emoji copy.png" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
    </style>
</head>
<body>
    <menu>
        <a href="index.html" id="instructions">place 3 non corners per board each</a>
    </menu>
    <script>function tableCreate() {
        const body = document.body,
        tbl0 = document.createElement('table');
        //tbl0.style.width = '40%';
        tbl0.style.border = '1px solid black';
        const tbl1 = document.createElement('table');
        //tbl1.style.width = '40%';
        tbl1.style.border = '1px solid black';


        var turn = Math.round(Math.random());
        var empty = [];
        var seed = [];
        var sprout = [];
        var crop = [];
        var defend = [];

        function rem(arr, item){
            //https://stackoverflow.com/questions/5767325/how-can-i-remove-a-specific-item-from-an-array-in-javascript
            var index = arr.indexOf(item);
            if (index > -1) { // only splice array when item is found
                arr.splice(index, 1); // 2nd parameter means remove one item only
            }
        }


        for (let board = 0; board < 2; board++){
            for (let i = 0; i < 6; i++) {
                if (board == 0){
                    var tr = tbl0.insertRow();
                }if (board == 1){
                    var tr = tbl1.insertRow();
                }
                
                for (let j = 0; j < 8; j++) {
                    var td = tr.insertCell();
                    var x = document.createElement("BUTTON");
                        x.className = "center";
                        x.style.height = "100%"
                        x.style.width = "100%"
                        x.style.fontSize = "9vmin"
                        x.style.padding = "0%"
                        x.style.margin = "0%"
                        x.textContent="-"
                        me = i.toString()+j.toString()+board.toString()
                        x.id = me
                        x.textContent.style="100%"

                        
                        // making the corners the right colour
                        //console.log(empty)


                        if ((i==0 || i==5) && (j==0 || j==7)){
                            defend.push(me)
                        }else{
                            empty.push(i.toString()+j.toString()+board.toString())
                        }

                        x.onclick = function() {
                            
                            butt = document.getElementById(i.toString()+j.toString()+board.toString());
                            coors = i.toString()+j.toString()+board.toString();
                            console.log(coors)
                            console.log("turn:",turn)

                            

                            var valid = true;

                            if (defend.length < 14){
                                owned0 = 0;
                                owned1 = 0;
                                defend.forEach(element => {
                                    if (element[2] == 0){
                                        owned0++;
                                    }else{
                                        owned1++;
                                    }
                                });
                                if (owned0 >= 7 && coors[2] ==0){
                                    valid = false;
                                }
                                if (owned1 >= 7 && coors[2] ==1){
                                    valid = false;
                                }
                                if (defend.includes(coors)){
                                    valid = false;
                                }
                            }

                            if (crop.includes(coors) || sprout.includes(coors) || defend.includes(coors)){
                                valid = false;
                            }

                            

                            if (valid){
                                console.log("valid move")

                                // starting pieces
                                if (defend.length < 14){
                                    defend.push(coors)
                                    rem(empty, coors);
                                }

                                // ensuring all defending pieces are the right colour
                                defend.forEach(element => {
                                    cell = document.getElementById(element)
                                    //console.log(element)
                                    cell.style.backgroundColor = document.getElementById('p'+element[2]+'colour').value;
                                });


                                if (defend.length >= 14){
                                    if (board == turn && (empty.includes(coors) || seed.includes(coors))){
                                    defend.push(coors);
                                    rem(empty, coors);
                                    butt.style.backgroundColor = document.getElementById('p'+coors[2]+'colour').value;
                                }
                                if (board != turn && empty.includes(coors)){
                                    crop.push(coors);
                                    rem(empty, coors);
                                    butt.style.color = document.getElementById('p'+turn+'colour').value;
                                    butt.textContent = "3"
                                }

                                }



                                // the last thing that happens needs to be player changing
                                if (turn == 0){
                                    turn = 1;
                                }else{
                                    turn = 0;
                                }
                                if(defend.length >13){
                                    document.getElementById("instructions").innerHTML = "player "+(turn+1).toString()+"'s turn";
                                }
                            }
                            else{
                                if(defend.length>14){
                                    document.getElementById("instructions").innerHTML = "invalid - player "+(turn+1).toString()+"'s turn";
                                }
                            }
                        }


                    
                    td.appendChild(x);
                    td.style.border = '1px solid black';
                    
                }
            }

            if (board == 0){
                body.appendChild(tbl0);
            }if (board == 1){
                body.appendChild(tbl1);
            }
            //body.appendChild(tbl);
            var para = document.createElement("p"); 
            var timerNode = document.createTextNode("Player "+String(board+1));
            para.appendChild(timerNode);
            document.body.appendChild(para);

        }
        
      }
      
      tableCreate();
      </script>

<label for="favcolor">Player 1 colour:</label>
<input type="color" id="p0colour" name="favcolor" value="#008080">

<label for="favcolor">Player 2 colour:</label>
<input type="color" id="p1colour" name="favcolor" value="#cb94f7">
      
</body>
</html>