<!DOCTYPE  html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="author" content="Dave Davies">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>Fungal Creep</title>
	<link rel="icon" type="image/png" href="face emoji copy.png" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
    </style>
</head>
<body>
    <menu>
        <a href="index.html" id="instructions">place 3 non corners per board each</a>
    </menu>
    <script>function tableCreate() {
        const body = document.body,
        tbl0 = document.createElement('table');
        //tbl0.style.width = '40%';
        tbl0.style.border = '1px solid black';
        const tbl1 = document.createElement('table');
        //tbl1.style.width = '40%';
        tbl1.style.border = '1px solid black';


        var turn = Math.round(Math.random());
        var empty = [];
        var seed = [];
        var sprout = [];
        var crop = [];
        var defend = [];

        function rem(arr, item){
            //https://stackoverflow.com/questions/5767325/how-can-i-remove-a-specific-item-from-an-array-in-javascript
            var index = arr.indexOf(item);
            if (index > -1) { // only splice array when item is found
                arr.splice(index, 1); // 2nd parameter means remove one item only
            }
        }

        boardWidth = 8;
        boardHeight = 6;

        for (let board = 0; board < 2; board++){
            for (let i = 0; i < boardHeight; i++) {
                if (board == 0){
                    var tr = tbl0.insertRow();
                }if (board == 1){
                    var tr = tbl1.insertRow();
                }
                
                for (let j = 0; j < boardWidth; j++) {
                    var td = tr.insertCell();
                    var b = document.createElement("BUTTON");
                        b.className = "center";
                        b.style.height = "100%"
                        b.style.width = "100%"
                        b.style.fontSize = "9vmin"
                        b.style.padding = "0%"
                        b.style.margin = "0%"
                        b.textContent="_"
                        me = i.toString()+j.toString()+board.toString()
                        b.id = me
                        b.textContent.style="100%"

                        
                        // making the corners the right colour
                        //console.log(empty)


                        if ((i==0 || i==5) && (j==0 || j==7)){
                            defend.push(me)
                        }else{
                            empty.push(i.toString()+j.toString()+board.toString())
                        }

                        b.onclick = function() {
                            
                            butt = document.getElementById(i.toString()+j.toString()+board.toString());
                            coors = i.toString()+j.toString()+board.toString();
                            console.log(coors)
                            console.log("turn:",turn)

                            

                            var valid = true;

                            if (defend.length < 14){
                                owned0 = 0;
                                owned1 = 0;
                                defend.forEach(element => {
                                    if (element[2] == 0){
                                        owned0++;
                                    }else{
                                        owned1++;
                                    }
                                });
                                if (owned0 >= 7 && coors[2] ==0){
                                    valid = false;
                                }
                                if (owned1 >= 7 && coors[2] ==1){
                                    valid = false;
                                }
                                if (defend.includes(coors)){
                                    valid = false;
                                }
                            }

                            if (crop.includes(coors) || sprout.includes(coors) || defend.includes(coors)){
                                valid = false;
                            }
                            // protects someone writing over their own 1
                            if (board != turn && seed.includes(coors)){
                                valid = false;
                            }

                            

                            if (valid){
                                console.log("valid move")

                                // starting pieces
                                if (defend.length < 14){
                                    defend.push(coors)
                                    rem(empty, coors);
                                }

                                // ensuring all defending pieces are the right colour
                                defend.forEach(element => {
                                    cell = document.getElementById(element)
                                    //console.log(element)
                                    cell.style.backgroundColor = document.getElementById('p'+element[2]+'colour').value;
                                });


                                if (defend.length >= 14){

                                    
                                    var fresh = [];

                                    // placing an attack or defense

                                    if (board == turn && (empty.includes(coors) || seed.includes(coors))){
                                        defend.push(coors);
                                        rem(empty, coors);
                                        rem(seed, coors);
                                        console.log("defense!")
                                        butt.style.backgroundColor = document.getElementById('p'+coors[2]+'colour').value;

                                        // othello update

                                        var x = parseInt(coors[0])
                                        var y = parseInt(coors[1])
                                        
                                        // making 8 lists of the directions going away from the piece that's going to do the othelloing
                                        var x_before = []
                                        var xy_before_above = []
                                        var y_above = []
                                        var xy_after_above = []
                                        var x_after = []
                                        var xy_after_below = []
                                        var y_below = []
                                        var xy_before_below = []
                                        var directions = [x_before, xy_before_above, y_above, xy_after_above, x_after, xy_after_below, y_below, xy_before_below]

                                        // adds the coordinates of each cell into its relevant direction
                                        for (let a = 0; a < x; a++){
                                            x_before.push(parseInt(x-1-a).toString()+parseInt(y).toString()+coors[2])
                                        }
                                        for (let a = 0; a < Math.min(x, y); a++){
                                            xy_before_above.push(parseInt(x-a-1).toString()+parseInt(y-a-1).toString()+coors[2])
                                        }
                                        for (let a = 0; a < y; a++){
                                            y_above.push(parseInt(x).toString() + parseInt( y-a-1).toString()+coors[2])
                                        }
                                        for (let a = 0; a < Math.min(boardWidth-x-1, y); a++){
                                            xy_after_above.push(parseInt( x+a+1).toString()+ parseInt( y-a-1).toString()+coors[2])
                                        }
                                        for (let a = 0; a < boardWidth-x-1; a++){
                                            x_after.push(parseInt( x+a+1).toString() + parseInt( y).toString()+coors[2])
                                        }
                                        for (let a = 0; a < Math.min(boardWidth-x-1, boardHeight-y-1); a++){
                                            xy_after_below.push(parseInt( x+a+1).toString() + parseInt( y+a+1).toString()+coors[2])
                                        }
                                        for (let a = 0; a < boardHeight-y-1; a++){
                                            y_below.push(parseInt( x).toString() + parseInt( y+a+1).toString()+coors[2])
                                        }
                                        for (let a = 0; a < Math.min(x, boardHeight-y-1); a++){
                                            xy_before_below.push(parseInt( x-a-1).toString() + parseInt( y+a+1).toString()+coors[2])
                                        }

                                        //goes through and puts any acres that should be claimed in to_flip
                                        console.log(directions)
                                        to_flip = []
                                        directions.forEach(direction => {
                                            attack_possible = true
                                            potential_flips = []
                                            direction.forEach(cell => {
                                                if (attack_possible && (seed.includes(cell) || sprout.includes(cell) || crop.includes(cell))){
                                                    potential_flips.push(cell)
                                                }
                                                else if (attack_possible && (defend.includes(cell))){
                                                    attack_possible = false
                                                    potential_flips.forEach(element => {
                                                        to_flip.push(element)
                                                    });
                                                }
                                                    

                                                // empty cell? no snack for you :(
                                                else if (attack_possible && empty.includes(cell)){
                                                    attack_possible = false
                                                    potential_flips = []
                                                }
                                                    
                                                });
                                        });
                                        // goes through consumed cells and eats them (turns them into defenders)
                                        to_flip.forEach(cell => {
                                            if (crop.includes(cell)){
                                                up = cell[0]+(cell[1]-1)+cell[2]
                                                down = cell[0]+(parseInt(cell[1])+1)+cell[2]
                                                left = (cell[0]-1)+(cell[1])+cell[2]
                                                right = (parseInt(cell[0])+1)+cell[1]+cell[2]
                                                dirs = [up, down, left, right]
                                                dirs.forEach(way => {
                                                    
                                                    if (seed.includes(way) && !to_flip.includes(way)){
                                                        empty.push(way);
                                                        rem(seed, way);
                                                        
                                                        document.getElementById(way).style.color = "#000000";
                                                        document.getElementById(way).textContent = "_";
                                                    }
                                                });
                                            }

                                            defend.push(cell);
                                            rem(empty, cell);
                                            rem(seed, cell);
                                            rem(sprout, cell);
                                            rem(crop, cell);
                                            console.log("defense!")
                                            document.getElementById(cell).style.backgroundColor = document.getElementById('p'+coors[2]+'colour').value;
                                        });
                                            
                                    }
                                    
                                    if (board != turn && empty.includes(coors)){
                                        fresh.push(coors);
                                        rem(empty, coors);
                                        butt.style.color = document.getElementById('p'+turn+'colour').value;
                                        butt.textContent = "3"
                                    }

                                    


                                    // growth update

                                
                                    // 2s growing up
                                    sprout.forEach(element => {
                                        if (element[2] == turn){
                                            //crop.push(element)
                                            fresh.push(element)
                                            document.getElementById(element).textContent = "3";
                                        }
                                    });
                                    crop.forEach(element => {
                                        if (sprout.includes(element)){
                                            rem(sprout,element);
                                        }
                                    });

                                    // 1s growing up
                                    seed.forEach(element => {
                                        if (element[2] == turn){
                                            sprout.push(element)
                                            document.getElementById(element).textContent = "2";
                                        }
                                    });
                                    sprout.forEach(element => {
                                        if (seed.includes(element)){
                                            rem(seed,element);
                                        }
                                    });

                                    // 3s having babies
                                    crop.forEach(element => {
                                        if (element[2] == turn){
                                            up = element[0]+(element[1]-1)+element[2]
                                            down = element[0]+(parseInt(element[1])+1)+element[2]
                                            left = (element[0]-1)+(element[1])+element[2]
                                            right = (parseInt(element[0])+1)+element[1]+element[2]
                                            dirs = [up, down, left, right]
                                            dirs.forEach(way => {
                                                
                                                if (empty.includes(way)){
                                                    seed.push(way);
                                                    rem(empty, way);
                                                    
                                                    document.getElementById(way).style.color = document.getElementById('p'+other+'colour').value;
                                                    document.getElementById(way).textContent = "1";
                                                }
                                            });
                                        }
                                    });


                                    fresh.forEach(element => {
                                        crop.push(element)
                                    });
                                    
                                }

                                


                                // the last thing that happens needs to be player changing
                                if (turn == 0){
                                    turn = 1;
                                    other = 0;
                                }else{
                                    turn = 0;
                                    other = 1;
                                }
                                if(defend.length >13){
                                    document.getElementById("instructions").innerHTML = "player "+(turn+1).toString()+"'s turn";
                                    document.getElementById("instructions").style.color = document.getElementById('p'+(turn).toString()+'colour').value;
                                }
                            }
                            else{
                                if(defend.length>14){
                                    document.getElementById("instructions").innerHTML = "invalid - player "+(turn+1).toString()+"'s turn";
                                    document.getElementById("instructions").style.color = document.getElementById('p'+(turn).toString()+'colour').value;
                                }
                            }
                            empty0 = 0;
                                empty1 = 1;
                                empty.forEach(element => {
                                    if(element[2] == 1){
                                        empty1++;
                                    }else{
                                        empty0++;
                                    }
                                });
                                if (empty0 == 0 || empty1 == 0){
                                    console.log("done!")
                                    points0 = 0;
                                    points1 = 0;
                                    seed.forEach(element => {
                                        if(element[2] == 0){
                                            points1++;
                                        }else{
                                            points0++
                                        }
                                    });
                                    sprout.forEach(element => {
                                        if(element[2] == 0){
                                            points1+=2;
                                        }else{
                                            points0+=2;
                                        }
                                    });
                                    crop.forEach(element => {
                                        if(element[2] == 0){
                                            points1+=3;
                                        }else{
                                            points0+=3;
                                        }
                                    });
                                    defend.forEach(element => {
                                        if(element[2] == 1){
                                            points1++;
                                        }else{
                                            points0++;
                                        }
                                    });
                                    var parad = document.createElement("h1"); 
                                    var timerNode = document.createTextNode("Player 1 score: "+String(points0));
                                    parad.appendChild(timerNode);
                                    document.body.appendChild(parad);
                                    var parau = document.createElement("h1"); 
                                    var timerNode = document.createTextNode("Player 2 score: "+String(points1));
                                    parau.appendChild(timerNode);
                                    document.body.appendChild(parau);

                                    if (points0 > points1){
                                        winner = 0;
                                    }else if (points0 < points1){
                                        winner = 1;
                                    }else{
                                        winner = 2;
                                    }
                                    document.getElementById("instructions").innerHTML = "player "+(winner).toString()+" wins!";
                                    document.getElementById("instructions").style.color = document.getElementById('p'+(winner).toString()+'colour').value;
                                    //document.getElementsByName("body").style.color = document.getElementById('p'+(winner).toString()+'colour').value;
                                    empty = [];
                                    seed = [];
                                }

                        }


                    
                    td.appendChild(b);
                    td.style.border = '1px solid black';
                    
                }
            }

            if (board == 0){
                body.appendChild(tbl0);
            }if (board == 1){
                body.appendChild(tbl1);
            }
            //body.appendChild(tbl);
            var para = document.createElement("p"); 
            var timerNode = document.createTextNode("Player "+String(board+1));
            para.appendChild(timerNode);
            document.body.appendChild(para);

        }
        
      }
      
      tableCreate();
      </script>

<label for="favcolor">Player 1 colour:</label>
<input type="color" id="p0colour" name="favcolor" value="#008080">

<label for="favcolor">Player 2 colour:</label>
<input type="color" id="p1colour" name="favcolor" value="#cb94f7">
      
</body>
</html>